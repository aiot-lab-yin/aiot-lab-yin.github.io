{%- comment -%}
  Usage in project pages:
    {% include project-publications.html project_id=page.project_id %}
  Renders publications related to a given project
  in a reference-style list like [1], [2], ...
{%- endcomment -%}

{%- assign all_pubs = site.data.publications -%}
{%- assign project_id = include.project_id -%}

{%- assign pubs = all_pubs | where_exp: "p", "p.projects contains project_id" -%}

{%- if pubs and pubs.size > 0 -%}
  <!-- 用无序列表 + 去掉默认符号，只保留 [n] -->
  <ul class="project-publications" style="list-style-type:none; padding-left:0;">
    {%- for pub in pubs -%}
      <li>
        <span class="pub-index">[{{ forloop.index }}]</span> 
        {%- if pub.authors -%}
          {{ pub.authors }}.
        {%- endif -%}

        {%- if pub.title -%}
          “{{ pub.title }}.”
        {%- endif -%}

        {%- if pub.venue_short or pub.venue or pub.year -%}
          {%- if pub.venue_short -%}
            <em>{{ pub.venue_short }}</em>
          {%- elsif pub.venue -%}
            <em>{{ pub.venue }}</em>
          {%- endif -%}
          {%- if pub.year %} ({{ pub.year }}){% endif -%}.
        {%- endif -%}

        {%- if pub.links -%}
        {%- assign has_doi = pub.links.doi and pub.links.doi != "" -%}
        {%- assign has_pdf = pub.links.pdf and pub.links.pdf != "" -%}
        {%- if has_doi or has_pdf -%}
            {%- if has_doi -%}
            <!-- 句子后紧跟 DOI / PDF，不换行 -->
            <span> </span><a href="{{ pub.links.doi }}" target="_blank">DOI</a>
            {%- endif -%}
            {%- if has_pdf -%}
            {%- if has_doi -%} · {% else %} <span> </span>{% endif -%}
            <a href="{{ pub.links.pdf }}" target="_blank">PDF</a>
            {%- endif -%}
        {%- endif -%}
        {%- endif -%}
      </li>
    {%- endfor -%}
  </ul>
{%- else -%}
  <p>No publications are registered for this project yet.</p>
{%- endif -%}